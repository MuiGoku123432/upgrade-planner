<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">

<!-- Import Results Modal -->
<div class="jarvis-theme modal"
     hx-on:click="if(event.target===this) document.getElementById('modal-container').innerHTML=''">
    <div class="modal-dialog" style="max-width: 600px;">
        <div class="modal-content">
            <div class="modal-header">
                <div>
                    <h4>Import Results</h4>
                </div>
                <button type="button" class="modal-close"
                        hx-on:click="document.getElementById('modal-container').innerHTML=''">&times;</button>
            </div>

            <div class="modal-body">
                <!-- Summary -->
                <div class="import-summary" style="margin-bottom: 1.5rem;">
                    <!-- Success Alert -->
                    <div th:if="${result.fullSuccess}"
                         style="padding: 1rem; background: rgba(76, 175, 80, 0.1); border: 1px solid #4CAF50; border-radius: 4px; color: #4CAF50;">
                        All <span th:text="${result.successCount}">0</span> parts imported successfully!
                    </div>

                    <!-- Partial Success Alert -->
                    <div th:if="${result.partialSuccess}"
                         style="padding: 1rem; background: rgba(255, 152, 0, 0.1); border: 1px solid #FF9800; border-radius: 4px; color: #FF9800;">
                        Partial import: <span th:text="${result.successCount}">0</span> succeeded,
                        <span th:text="${result.failureCount}">0</span> failed
                    </div>

                    <!-- Full Failure Alert -->
                    <div th:if="${result.successCount == 0 and result.failureCount > 0}"
                         style="padding: 1rem; background: rgba(244, 67, 54, 0.1); border: 1px solid #F44336; border-radius: 4px; color: #F44336;">
                        Import failed: No parts were imported. <span th:text="${result.failureCount}">0</span> rows had errors.
                    </div>

                    <!-- Stats -->
                    <div style="display: flex; gap: 2rem; margin-top: 1rem; flex-wrap: wrap;">
                        <div>
                            <strong>Total Rows:</strong> <span th:text="${result.totalRows}">0</span>
                        </div>
                        <div style="color: #4CAF50;">
                            <strong>Imported:</strong> <span th:text="${result.successCount}">0</span>
                        </div>
                        <div style="color: #F44336;">
                            <strong>Failed:</strong> <span th:text="${result.failureCount}">0</span>
                        </div>
                    </div>
                </div>

                <!-- Errors Section -->
                <div th:if="${not #lists.isEmpty(result.errors)}" class="errors-section">
                    <h5 style="color: #F44336; margin-bottom: 0.5rem;">Errors</h5>
                    <div style="max-height: 300px; overflow-y: auto; border: 1px solid var(--muted-border-color); border-radius: 4px;">
                        <table style="width: 100%; font-size: 0.9rem; border-collapse: collapse;">
                            <thead style="background: var(--card-background-color); position: sticky; top: 0;">
                                <tr>
                                    <th style="padding: 0.5rem; text-align: left; border-bottom: 1px solid var(--muted-border-color);">Row</th>
                                    <th style="padding: 0.5rem; text-align: left; border-bottom: 1px solid var(--muted-border-color);">Name</th>
                                    <th style="padding: 0.5rem; text-align: left; border-bottom: 1px solid var(--muted-border-color);">Errors</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr th:each="rowError : ${result.errors}" style="border-bottom: 1px solid var(--muted-border-color);">
                                    <td style="padding: 0.5rem; vertical-align: top;" th:text="${rowError.rowNumber}">1</td>
                                    <td style="padding: 0.5rem; vertical-align: top;">
                                        <small th:text="${rowError.rowData.get('name') ?: '(no name)'}">Part name</small>
                                    </td>
                                    <td style="padding: 0.5rem; vertical-align: top;">
                                        <ul style="margin: 0; padding-left: 1rem; color: #F44336;">
                                            <li th:each="err : ${rowError.errors}"
                                                th:text="${err}">Error</li>
                                        </ul>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <div class="modal-footer">
                <button type="button" class="btn btn-secondary"
                        hx-on:click="document.getElementById('modal-container').innerHTML=''">
                    Close
                </button>
                <button th:if="${result.failureCount > 0}"
                        type="button"
                        class="btn btn-primary"
                        hx-get="/builds/modals/import-parts"
                        th:hx-vals="|{'buildId': '${buildId}'}|"
                        hx-target="#modal-container"
                        hx-swap="innerHTML">
                    Try Again
                </button>
            </div>
        </div>
    </div>
</div>

</html>
