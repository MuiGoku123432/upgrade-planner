<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org" xmlns:sec="http://www.thymeleaf.org/extras/spring-security" data-theme="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Authorize Application - Car Builder VIN</title>

    <!-- CSS -->
    <link rel="stylesheet" th:href="@{/css/pico.min.css}">
    <link rel="stylesheet" th:href="@{/css/theme.css}">
    <link rel="stylesheet" th:href="@{/css/components.css}">

    <style>
        .consent-card {
            max-width: 500px;
            margin: 2rem auto;
        }
        .app-icon {
            width: 64px;
            height: 64px;
            background: var(--pico-primary-background);
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2rem;
            margin: 0 auto 1rem;
        }
        .app-name {
            text-align: center;
            margin-bottom: 0.5rem;
        }
        .scope-list {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 8px;
            padding: 1rem;
            margin: 1.5rem 0;
        }
        .scope-item {
            display: flex;
            align-items: flex-start;
            gap: 0.75rem;
            padding: 0.75rem 0;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }
        .scope-item:last-child {
            border-bottom: none;
        }
        .scope-icon {
            color: var(--pico-primary);
            font-size: 1.2rem;
            margin-top: 0.1rem;
        }
        .scope-name {
            font-weight: 600;
            margin-bottom: 0.25rem;
        }
        .scope-desc {
            font-size: 0.9rem;
            color: var(--pico-muted-color);
        }
        .button-group {
            display: flex;
            gap: 1rem;
            margin-top: 1.5rem;
        }
        .button-group button {
            flex: 1;
        }
        .user-info {
            text-align: center;
            font-size: 0.9rem;
            color: var(--pico-muted-color);
            margin-bottom: 1.5rem;
        }
    </style>
</head>
<body>
    <!-- Navigation -->
    <nav class="container-fluid">
        <ul>
            <li><a href="/" class="contrast"><strong>Car Builder VIN</strong></a></li>
        </ul>
        <ul>
            <li sec:authorize="isAuthenticated()">
                <span sec:authentication="name">User</span>
            </li>
        </ul>
    </nav>

    <!-- Main Content -->
    <main class="jarvis-theme container">
        <div id="main-content">
            <div class="jarvis-card consent-card">
                <!-- App Icon -->
                <div class="app-icon">
                    <span>&#x1F916;</span>
                </div>

                <!-- App Name -->
                <h2 class="app-name" th:text="${consent.clientName}">Application Name</h2>

                <p class="user-info">
                    wants to access your Car Builder VIN account
                </p>

                <!-- Requested Permissions -->
                <div class="scope-list">
                    <h4 style="margin-bottom: 0.75rem;">This will allow the application to:</h4>
                    <div th:each="scopeDesc : ${consent.scopeDescriptions}" class="scope-item">
                        <span class="scope-icon">&#x2713;</span>
                        <div>
                            <div class="scope-name" th:text="${scopeDesc.scope}">Scope</div>
                            <div class="scope-desc" th:text="${scopeDesc.description}">Description</div>
                        </div>
                    </div>
                </div>

                <!-- Consent Form -->
                <form th:action="@{/oauth/authorize}" method="post">
                    <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}"/>

                    <p style="font-size: 0.85rem; color: var(--pico-muted-color); margin-bottom: 1rem;">
                        By clicking "Allow", you authorize this application to access your data as described above.
                        You can revoke this access at any time from your Settings.
                    </p>

                    <div class="button-group">
                        <button type="submit" name="decision" value="deny" class="outline secondary">
                            Deny
                        </button>
                        <button type="submit" name="decision" value="approve" class="nav-btn nav-btn-primary">
                            Allow
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </main>
</body>
</html>
